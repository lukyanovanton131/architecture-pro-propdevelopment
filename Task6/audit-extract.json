=== Kubernetes Audit Log Analysis ===
Analyzing: ./audit.log

1. SECRET ACCESS ATTEMPTS BY MONITORING SERVICE ACCOUNT:
{"kind":"Event","apiVersion":"audit.k8s.io/v1","level":"RequestResponse","auditID":"d98dbf26-5d32-4b1a-9ca4-454b640286b7","stage":"ResponseComplete","requestURI":"/api/v1/namespaces/kube-system/secrets?limit=500","verb":"list","user":{"username":"minikube-user","groups":["system:masters","system:authenticated"],"extra":{"authentication.kubernetes.io/credential-id":["X509SHA256=901c226cc2aee725f6e77c88f9eaac4aa97660d45e2112ae54ef6066006d8fe5"]}},"impersonatedUser":{"username":"system:serviceaccount:secure-ops:monitoring","groups":["system:serviceaccounts","system:serviceaccounts:secure-ops","system:authenticated"]},"sourceIPs":["192.168.49.1"],"userAgent":"kubectl/v1.24.2 (darwin/arm64) kubernetes/f66044f","objectRef":{"resource":"secrets","namespace":"kube-system","apiVersion":"v1"},"responseStatus":{"metadata":{},"status":"Failure","message":"secrets is forbidden: User \"system:serviceaccount:secure-ops:monitoring\" cannot list resource \"secrets\" in API group \"\" in the namespace \"kube-system\"","reason":"Forbidden","details":{"kind":"secrets"},"code":403},"responseObject":{"kind":"Status","apiVersion":"v1","metadata":{},"status":"Failure","message":"secrets is forbidden: User \"system:serviceaccount:secure-ops:monitoring\" cannot list resource \"secrets\" in API group \"\" in the namespace \"kube-system\"","reason":"Forbidden","details":{"kind":"secrets"},"code":403},"requestReceivedTimestamp":"2025-12-27T03:36:51.430793Z","stageTimestamp":"2025-12-27T03:36:51.431119Z","annotations":{"authorization.k8s.io/decision":"forbid","authorization.k8s.io/reason":""}}

2. PRIVILEGED POD CREATION:
{"kind":"Event","apiVersion":"audit.k8s.io/v1","level":"Request","auditID":"33bbf1bd-c252-42ea-ab05-ae2e92eeeb7e","stage":"ResponseComplete","requestURI":"/api/v1/namespaces/kube-system/pods","verb":"create","user":{"username":"system:node:minikube","groups":["system:nodes","system:authenticated"],"extra":{"authentication.kubernetes.io/credential-id":["X509SHA256=faffa624a6989b38c936829851d00ca6ae376c5024211eda8bcfcc61f9e93477"]}},"sourceIPs":["192.168.49.2"],"userAgent":"kubelet/v1.34.0 (linux/arm64) kubernetes/f28b4c9","objectRef":{"resource":"pods","namespace":"kube-system","name":"kube-apiserver-minikube","uid":"06afaeaba0a778aa16699ef5860743b4","apiVersion":"v1"},"responseStatus":{"metadata":{},"code":201},"requestObject":{"kind":"Pod","apiVersion":"v1","metadata":{"name":"kube-apiserver-minikube","namespace":"kube-system","uid":"06afaeaba0a778aa16699ef5860743b4","labels":{"component":"kube-apiserver","tier":"control-plane"},"annotations":{"kubeadm.kubernetes.io/kube-apiserver.advertise-address.endpoint":"192.168.49.2:8443","kubernetes.io/config.hash":"06afaeaba0a778aa16699ef5860743b4","kubernetes.io/config.mirror":"06afaeaba0a778aa16699ef5860743b4","kubernetes.io/config.seen":"2025-12-27T03:35:11.861673379Z","kubernetes.io/config.source":"file"},"ownerReferences":[{"apiVersion":"v1","kind":"Node","name":"minikube","uid":"aee4891b-df26-4528-b9c2-f23ec4f13fb0","controller":true}]},"spec":{"volumes":[{"name":"ca-certs","hostPath":{"path":"/etc/ssl/certs","type":"DirectoryOrCreate"}},{"name":"etc-ca-certificates","hostPath":{"path":"/etc/ca-certificates","type":"DirectoryOrCreate"}},{"name":"k8s-certs","hostPath":{"path":"/var/lib/minikube/certs","type":"DirectoryOrCreate"}},{"name":"usr-local-share-ca-certificates","hostPath":{"path":"/usr/local/share/ca-certificates","type":"DirectoryOrCreate"}},{"name":"usr-share-ca-certificates","hostPath":{"path":"/usr/share/ca-certificates","type":"DirectoryOrCreate"}},{"name":"audit","hostPath":{"path":"/etc/kubernetes/audit","type":"DirectoryOrCreate"}}],"containers":[{"name":"kube-apiserver","image":"registry.k8s.io/kube-apiserver:v1.34.0","command":["kube-apiserver","--advertise-address=192.168.49.2","--allow-privileged=true","--authorization-mode=Node,RBAC","--client-ca-file=/var/lib/minikube/certs/ca.crt","--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota","--enable-bootstrap-token-auth=true","--etcd-cafile=/var/lib/minikube/certs/etcd/ca.crt","--etcd-certfile=/var/lib/minikube/certs/apiserver-etcd-client.crt","--etcd-keyfile=/var/lib/minikube/certs/apiserver-etcd-client.key","--etcd-servers=https://127.0.0.1:2379","--kubelet-client-certificate=/var/lib/minikube/certs/apiserver-kubelet-client.crt","--kubelet-client-key=/var/lib/minikube/certs/apiserver-kubelet-client.key","--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname","--proxy-client-cert-file=/var/lib/minikube/certs/front-proxy-client.crt","--proxy-client-key-file=/var/lib/minikube/certs/front-proxy-client.key","--requestheader-allowed-names=front-proxy-client","--requestheader-client-ca-file=/var/lib/minikube/certs/front-proxy-ca.crt","--requestheader-extra-headers-prefix=X-Remote-Extra-","--requestheader-group-headers=X-Remote-Group","--requestheader-username-headers=X-Remote-User","--secure-port=8443","--service-account-issuer=https://kubernetes.default.svc.cluster.local","--service-account-key-file=/var/lib/minikube/certs/sa.pub","--service-account-signing-key-file=/var/lib/minikube/certs/sa.key","--service-cluster-ip-range=10.96.0.0/12","--tls-cert-file=/var/lib/minikube/certs/apiserver.crt","--tls-private-key-file=/var/lib/minikube/certs/apiserver.key","--audit-policy-file=/etc/kubernetes/audit/audit-policy.yaml","--audit-log-path=/etc/kubernetes/audit/audit.log","--audit-log-maxage=30","--audit-log-maxbackup=10","--audit-log-maxsize=100"],"ports":[{"name":"probe-port","hostPort":8443,"containerPort":8443,"protocol":"TCP"}],"resources":{"requests":{"cpu":"250m"}},"volumeMounts":[{"name":"ca-certs","readOnly":true,"mountPath":"/etc/ssl/certs"},{"name":"etc-ca-certificates","readOnly":true,"mountPath":"/etc/ca-certificates"},{"name":"k8s-certs","readOnly":true,"mountPath":"/var/lib/minikube/certs"},{"name":"usr-local-share-ca-certificates","readOnly":true,"mountPath":"/usr/local/share/ca-certificates"},{"name":"usr-share-ca-certificates","readOnly":true,"mountPath":"/usr/share/ca-certificates"},{"name":"audit","mountPath":"/etc/kubernetes/audit"}],"livenessProbe":{"httpGet":{"path":"/livez","port":"probe-port","host":"192.168.49.2","scheme":"HTTPS"},"initialDelaySeconds":10,"timeoutSeconds":15,"periodSeconds":10,"successThreshold":1,"failureThreshold":8},"readinessProbe":{"httpGet":{"path":"/readyz","port":"probe-port","host":"192.168.49.2","scheme":"HTTPS"},"timeoutSeconds":15,"periodSeconds":1,"successThreshold":1,"failureThreshold":3},"startupProbe":{"httpGet":{"path":"/livez","port":"probe-port","host":"192.168.49.2","scheme":"HTTPS"},"initialDelaySeconds":10,"timeoutSeconds":15,"periodSeconds":10,"successThreshold":1,"failureThreshold":24},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"IfNotPresent"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","nodeName":"minikube","hostNetwork":true,"securityContext":{"seccompProfile":{"type":"RuntimeDefault"}},"schedulerName":"default-scheduler","tolerations":[{"operator":"Exists","effect":"NoExecute"}],"priorityClassName":"system-node-critical","priority":2000001000,"enableServiceLinks":true},"status":{"phase":"Pending"}},"requestReceivedTimestamp":"2025-12-27T03:35:49.041695Z","stageTimestamp":"2025-12-27T03:35:49.049621Z","annotations":{"authorization.k8s.io/decision":"allow","authorization.k8s.io/reason":"","pod-security.kubernetes.io/enforce-policy":"privileged:latest"}}
{"kind":"Event","apiVersion":"audit.k8s.io/v1","level":"Request","auditID":"f141cfa2-3c2b-493e-ae0f-9c5551f47436","stage":"ResponseComplete","requestURI":"/api/v1/namespaces/secure-ops/pods?fieldManager=kubectl-run","verb":"create","user":{"username":"minikube-user","groups":["system:masters","system:authenticated"],"extra":{"authentication.kubernetes.io/credential-id":["X509SHA256=901c226cc2aee725f6e77c88f9eaac4aa97660d45e2112ae54ef6066006d8fe5"]}},"sourceIPs":["192.168.49.1"],"userAgent":"kubectl/v1.24.2 (darwin/arm64) kubernetes/f66044f","objectRef":{"resource":"pods","namespace":"secure-ops","name":"attacker-pod","apiVersion":"v1"},"responseStatus":{"metadata":{},"code":201},"requestObject":{"kind":"Pod","apiVersion":"v1","metadata":{"name":"attacker-pod","labels":{"run":"attacker-pod"}},"spec":{"containers":[{"name":"attacker-pod","image":"alpine","command":["sleep","3600"],"resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always"}],"restartPolicy":"Always","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","securityContext":{},"schedulerName":"default-scheduler","enableServiceLinks":true},"status":{}},"requestReceivedTimestamp":"2025-12-27T03:36:51.226997Z","stageTimestamp":"2025-12-27T03:36:51.232076Z","annotations":{"authorization.k8s.io/decision":"allow","authorization.k8s.io/reason":"","pod-security.kubernetes.io/enforce-policy":"privileged:latest"}}
{"kind":"Event","apiVersion":"audit.k8s.io/v1","level":"Request","auditID":"acf52f14-7589-4e5a-812d-fb7cc479fa11","stage":"ResponseComplete","requestURI":"/api/v1/namespaces/secure-ops/pods?fieldManager=kubectl-client-side-apply\u0026fieldValidation=Strict","verb":"create","user":{"username":"minikube-user","groups":["system:masters","system:authenticated"],"extra":{"authentication.kubernetes.io/credential-id":["X509SHA256=901c226cc2aee725f6e77c88f9eaac4aa97660d45e2112ae54ef6066006d8fe5"]}},"sourceIPs":["192.168.49.1"],"userAgent":"kubectl/v1.24.2 (darwin/arm64) kubernetes/f66044f","objectRef":{"resource":"pods","namespace":"secure-ops","name":"privileged-pod","apiVersion":"v1"},"responseStatus":{"metadata":{},"code":201},"requestObject":{"kind":"Pod","apiVersion":"v1","metadata":{"name":"privileged-pod","namespace":"secure-ops","annotations":{"kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"v1\",\"kind\":\"Pod\",\"metadata\":{\"annotations\":{},\"name\":\"privileged-pod\",\"namespace\":\"secure-ops\"},\"spec\":{\"containers\":[{\"command\":[\"sleep\",\"3600\"],\"image\":\"alpine\",\"name\":\"pwn\",\"securityContext\":{\"privileged\":true}}],\"restartPolicy\":\"Never\"}}\n"}},"spec":{"containers":[{"name":"pwn","image":"alpine","command":["sleep","3600"],"resources":{},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","imagePullPolicy":"Always","securityContext":{"privileged":true}}],"restartPolicy":"Never","terminationGracePeriodSeconds":30,"dnsPolicy":"ClusterFirst","securityContext":{},"schedulerName":"default-scheduler","enableServiceLinks":true},"status":{}},"requestReceivedTimestamp":"2025-12-27T03:36:51.831927Z","stageTimestamp":"2025-12-27T03:36:51.834819Z","annotations":{"authorization.k8s.io/decision":"allow","authorization.k8s.io/reason":"","pod-security.kubernetes.io/enforce-policy":"privileged:latest"}}
{"kind":"Event","apiVersion":"audit.k8s.io/v1","level":"Metadata","auditID":"f76e93e9-6fd4-4694-82c7-98e70bd77bde","stage":"ResponseComplete","requestURI":"/api/v1/namespaces/secure-ops/pods/privileged-pod/binding","verb":"create","user":{"username":"system:kube-scheduler","groups":["system:authenticated"],"extra":{"authentication.kubernetes.io/credential-id":["X509SHA256=637c714ead716479f16b7fe97709721686ea5cc2b06688d108e06328181a9cfe"]}},"sourceIPs":["192.168.49.2"],"userAgent":"kube-scheduler/v1.34.0 (linux/arm64) kubernetes/f28b4c9/scheduler","objectRef":{"resource":"pods","namespace":"secure-ops","name":"privileged-pod","uid":"e30e0723-66b4-4a05-8911-2a2cf92f8ba0","apiVersion":"v1","subresource":"binding"},"responseStatus":{"metadata":{},"status":"Success","code":201},"requestReceivedTimestamp":"2025-12-27T03:36:51.835595Z","stageTimestamp":"2025-12-27T03:36:51.837155Z","annotations":{"authorization.k8s.io/decision":"allow","authorization.k8s.io/reason":"RBAC: allowed by ClusterRoleBinding \"system:kube-scheduler\" of ClusterRole \"system:kube-scheduler\" to User \"system:kube-scheduler\""}}

3. EXEC COMMANDS IN COREDNS POD:

4. ATTEMPTS TO DELETE AUDIT POLICY:

5. ROLEBINDING WITH CLUSTER-ADMIN PRIVILEGES:
{"kind":"Event","apiVersion":"audit.k8s.io/v1","level":"RequestResponse","auditID":"2f51bea4-dbd8-49e0-8de0-018c3c492674","stage":"ResponseComplete","requestURI":"/apis/rbac.authorization.k8s.io/v1/namespaces/secure-ops/rolebindings?fieldManager=kubectl-client-side-apply\u0026fieldValidation=Strict","verb":"create","user":{"username":"minikube-user","groups":["system:masters","system:authenticated"],"extra":{"authentication.kubernetes.io/credential-id":["X509SHA256=901c226cc2aee725f6e77c88f9eaac4aa97660d45e2112ae54ef6066006d8fe5"]}},"sourceIPs":["192.168.49.1"],"userAgent":"kubectl/v1.24.2 (darwin/arm64) kubernetes/f66044f","objectRef":{"resource":"rolebindings","namespace":"secure-ops","name":"escalate-binding","apiGroup":"rbac.authorization.k8s.io","apiVersion":"v1"},"responseStatus":{"metadata":{},"code":201},"requestObject":{"kind":"RoleBinding","apiVersion":"rbac.authorization.k8s.io/v1","metadata":{"name":"escalate-binding","namespace":"secure-ops","annotations":{"kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"rbac.authorization.k8s.io/v1\",\"kind\":\"RoleBinding\",\"metadata\":{\"annotations\":{},\"name\":\"escalate-binding\",\"namespace\":\"secure-ops\"},\"roleRef\":{\"apiGroup\":\"rbac.authorization.k8s.io\",\"kind\":\"ClusterRole\",\"name\":\"cluster-admin\"},\"subjects\":[{\"kind\":\"ServiceAccount\",\"name\":\"monitoring\",\"namespace\":\"secure-ops\"}]}\n"}},"subjects":[{"kind":"ServiceAccount","name":"monitoring","namespace":"secure-ops"}],"roleRef":{"apiGroup":"rbac.authorization.k8s.io","kind":"ClusterRole","name":"cluster-admin"}},"responseObject":{"kind":"RoleBinding","apiVersion":"rbac.authorization.k8s.io/v1","metadata":{"name":"escalate-binding","namespace":"secure-ops","uid":"044d395a-bf29-44a7-b022-87b99367bbdd","resourceVersion":"542","creationTimestamp":"2025-12-27T03:36:52Z","annotations":{"kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"rbac.authorization.k8s.io/v1\",\"kind\":\"RoleBinding\",\"metadata\":{\"annotations\":{},\"name\":\"escalate-binding\",\"namespace\":\"secure-ops\"},\"roleRef\":{\"apiGroup\":\"rbac.authorization.k8s.io\",\"kind\":\"ClusterRole\",\"name\":\"cluster-admin\"},\"subjects\":[{\"kind\":\"ServiceAccount\",\"name\":\"monitoring\",\"namespace\":\"secure-ops\"}]}\n"},"managedFields":[{"manager":"kubectl-client-side-apply","operation":"Update","apiVersion":"rbac.authorization.k8s.io/v1","time":"2025-12-27T03:36:52Z","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:kubectl.kubernetes.io/last-applied-configuration":{}}},"f:roleRef":{},"f:subjects":{}}}]},"subjects":[{"kind":"ServiceAccount","name":"monitoring","namespace":"secure-ops"}],"roleRef":{"apiGroup":"rbac.authorization.k8s.io","kind":"ClusterRole","name":"cluster-admin"}},"requestReceivedTimestamp":"2025-12-27T03:36:52.167382Z","stageTimestamp":"2025-12-27T03:36:52.171501Z","annotations":{"authorization.k8s.io/decision":"allow","authorization.k8s.io/reason":""}}

=== Analysis Complete ===
