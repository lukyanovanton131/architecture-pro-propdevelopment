
## Общие требования к безопасности:

1. Все соединения с API должны использовать TLS не ниже версии 1.2.

2. Хранение и обработка биометрических данных (шаблоны лиц) должно осуществляться исключительно на серверах PropDevelopment в обезличенном виде (хеши, векторы признаков)
на территории РФ, и не передаваться за границу.
3. Данные должны хранится в зашифрованном виде.
4. При удалении пользователя из системы PropDevelopment должен безвозвратно удалить все его биометрические данные.

## Протоколы аутентификации и авторизации
OAuth 2.0 / OpenID Connect с использованием Client Credentials Grant.
На стороне партнера в его сервисе авторизации регистрируется клиент с помощью которого сервис управления домофоном и сервис управления шлагбаумом PropDevelopment будут авторизоваться и выполнять запросы с API партнера.
Выдается ClientId и ClientSecret.
Аналогично на стороне PropDevelopment в его сервисе авторизации регистрируется клиент для авторизации и выполнения запросов в API PropDevelopment.
## Организация взаимодействие между системами предприятия и внешней платформой

### Автоматическое открывание двери при распознавании пользователя по биометрии (по лицу):
- Камера домофона делает снимок лица пользователя и передает изображение на сервер партнера.
- На сервере партнера производится вычисление векторов базовых признаков без сохранения изображения.
- Программный клиент партнера, зарегистрированный в сервис авторизации PropDevelopment, выполняет процедуру аутентификации на стороне PropDevelopment, путем передачи запроса в API Gateway PropDevelopment
с телом, содержащим вектора признаков по протоколу OAuth 2.0 / OpenID Connect с использованием Client Credentials Grant.
  API Gateway PropDevelopment перенаправляет запрос в сервис авторизации. В случае успеха, сервис авторизации выдает JWT токен, который передается программному клиенту партнера.
JWT токен содержит идентификатор аутентифицированного пользователя и доступные для него claims.
- Программный клиент партнера выполняет запрос на открытие двери через API Gateway PropDevelopment с полученным JWT токеном в сервис управления домофоном PropDevelopment.
В запросе передается минимально необходимая информация для идентификации устройства открывания двери (его ИД).
- Сервис управления домофоном выполняет все необходимые проверки (оплата услуги и тд.) и авторизует выполнение операции открытия двери.
Через шлюз сервис управления домофоном выполняет запрос в API Gateway партнера с командой открытия двери, передавая ИД устройства открывания двери.
Перед выполнением запроса клиент сервиса управления домофоном  авторизуется в сервисе авторизации партнера по протоколу OAuth 2.0 / OpenID Connect с использованием Client Credentials Grant.

Альтернативный вариант.
Авторизация программного клиента партнера происходит без передачи вектора признаков, т.е. производится аутентификация только клиента.
Далее клиент выполняет запрос в API Gateway PropDevelopment в сервис управления домофоном с передачей вектора признаков и ИД устройства открывания двери.


### Классическое открывание двери
- При открывании двери ключом сервер партнера выполняет запрос к API PropDevelopment  в Webhook в сервис управления домофоном и передает ID ключа и время открытия.
Это необходимо для аудита.


### Автоматическое открывание по номеру автомобиля:
- Камера шлагбаума делает снимок номера автомобиля и передает изображение на сервер партнера.
- На сервере партнера производится распознавание буквенно-цифровая комбинации номера без сохранения изображения.
- Программный клиент партнера, зарегистрированный в сервис авторизации PropDevelopment, выполняет процедуру аутентификации на стороне PropDevelopment, путем передачи запроса в API Gateway PropDevelopment
  с телом, содержащим буквенно-цифровую комбинацию по протоколу OAuth 2.0 / OpenID Connect с использованием Client Credentials Grant.
  API Gateway PropDevelopment перенаправляет запрос в сервис авторизации. В случае успеха, сервис авторизации выдает JWT токен, который передается программному клиенту партнера.
- Программный клиент партнера выполняет запрос на открытие шлагбаума через API Gateway PropDevelopment с полученным JWT токеном в сервис управления шлагбаумом PropDevelopment.
  В запросе передается минимально необходимая информация для идентификации шлагбаума (его ИД).
- Сервис управления домофоном выполняет все необходимые проверки (оплата услуги и тд.) и авторизует выполнение операции открытия шлагбаума.
  Через шлюз сервис управления шлагбаумом выполняет запрос в API Gateway партнера с командой открытия шлагбаума, передавая ИД шлагбаума.
  Перед выполнением запроса клиент сервиса управления шлагбаумом авторизуется в сервисе авторизации партнера по протоколу OAuth 2.0 / OpenID Connect с использованием Client Credentials Grant.

Альтернативный вариант.
Авторизация программного клиента партнера происходит без передачи буквенно-цифровая комбинации номера, т.е. производится аутентификация только клиента.
Далее клиент выполняет запрос в API Gateway PropDevelopment в сервис управления шлагбаумом с передачей буквенно-цифровой комбинации номера и ИД шлагбаума.


### Классическое открывание шлагбаума 
- При открывании шлагбаума брелоком сервер партнера выполняет запрос к API PropDevelopment  в Webhook в сервис управления шлагбаума и передает ID брелока и время открытия.
  Это необходимо для аудита.






